SELECT DISPLAY_VALUE,A.QUEUE_TYPE
,sum(case when STATUS IN (20,22,23) then 1 else 0 end) AS PendCount
,sum(case when STATUS IN (100) then 1 else 0 end) AS FailedCount
FROM ARBOR.CUSTOMER_ORDER C,ARBOR.ORDER_WORK_QUEUE A,ARBOR.QUEUE_TYPE_VALUES B
WHERE C.ORDER_STATUS NOT IN (5,6) AND C.ORDER_ID=A.ORDER_ID AND A.QUEUE_TYPE NOT IN (69,46)
AND A.QUEUE_TYPE=B.QUEUE_TYPE AND B.LANGUAGE_CODE=1 AND TRUNC(CHG_DATE)>TRUNC(SYSDATE-100) AND STATUS IN (20,22,23,100)--=100-- IN (20,22,23)--=100-- -- (100) 
GROUP BY DISPLAY_VALUE,A.QUEUE_TYPE
HAVING COUNT(1)>10 
ORDER BY  COUNT(1) DESC

SELECT COUNT(*) FROM ORDER_WORK_QUEUE WHERE QUEUE_TYPE=55 AND STATUS=100 

SELECT DISPLAY_VALUE,TRANSACTION_ID,QUEUE_TYPE,COUNT(1) COUNT
FROM ARBOR.CUSTOMER_ORDER C,ARBOR.ORDER_WORK_QUEUE A,ARBOR.MILESTONE_VALUES B
WHERE C.ORDER_STATUS NOT IN (5,6) AND C.ORDER_ID=A.ORDER_ID 
AND A.TRANSACTION_ID=B.MILESTONE_ID AND B.LANGUAGE_CODE=1 AND TRUNC(CHG_DATE)>TRUNC(SYSDATE-20) AND QUEUE_TYPE=47 AND STATUS IN (20,22,23) --AND 
GROUP BY DISPLAY_VALUE,TRANSACTION_ID,QUEUE_TYPE
ORDER BY  COUNT(1) DESC

SELECT ROWID--,O.ORDER_ID||','
, O.* FROM ARBOR.ORDER_WORK_QUEUE O WHERE O.ORDER_ID IN (SELECT ORDER_ID FROM ARBOR.CUSTOMER_ORDER WHERE ORDER_STATUS NOT IN (5,6))
AND QUEUE_TYPE=47 AND STATUS IN (20,22,23) --AND TRANSACTION_ID=201050 
AND TRUNC(CHG_DATE)>TRUNC(SYSDATE-20) --AND TRUNC(DUE_DATE)>TRUNC(SYSDATE-3)
--AND OWNER<>0
ORDER BY O.CHG_DATE DESC

SELECT ROWID--,O.ORDER_ID||','
, O.* FROM ARBOR.ORDER_WORK_QUEUE O WHERE QUEUE_TYPE=47 AND STATUS IN (50,100) --AND TRANSACTION_ID=201050 
AND CHG_DATE>'29-OCT-2024' 
--AND OWNER<>0
ORDER BY O.CHG_DATE DESC

SELECT ROWID--,O.ORDER_ID||','
, O.* FROM ARBOR.ORDER_WORK_QUEUE_ERROR O WHERE QUEUE_TYPE=47 AND STATUS IN (100) --AND TRANSACTION_ID=201050 
AND CHG_DATE>'29-OCT-2024' 
--AND OWNER<>0
ORDER BY O.CHG_DATE DESC

SELECT sysdate+2/360,sysdate,to_date (sysdate,'DD-MM-YYYY HH24:MI:SS') + INTERVAL '1' MINUTE from dual

select count(1) , TO_CHAR(co.create_dt, 'YYYY-MM-DD HH24') , decode(order_status,5,'Cancelled',6,'Completed', 2, 'InProgress'), u.CREATE_WHO
from customer_order co, history h , user_history_comment u
where trunc(co.create_dt) >='21-Oct-2024' 
and h.history_id=co.order_id
and h.history_id=u.history_id
and u.COMMENTS='Order Created'
 group by  order_status ,TO_CHAR(co.create_dt, 'YYYY-MM-DD HH24') ,u.CREATE_WHO
 order by TO_CHAR(co.create_dt, 'YYYY-MM-DD HH24')

update ORDER_WORK_QUEUE set owner=0 where QUEUE_TYPE=44 and tracking_id in (SELECT O.tracking_id FROM ARBOR.ORDER_WORK_QUEUE O
WHERE O.ORDER_ID IN (SELECT ORDER_ID FROM ARBOR.CUSTOMER_ORDER WHERE ORDER_STATUS NOT IN (5,6))
AND STATUS IN (20,22,23) AND QUEUE_TYPE=44 --AND TRANSACTION_ID=201050 
AND TRUNC(CHG_DATE)>TRUNC(SYSDATE-10) AND TRUNC(DUE_DATE)>TRUNC(SYSDATE-10) and owner='70.68480977108451999584426589059540655241')

SELECT O.tracking_id FROM ARBOR.ORDER_WORK_QUEUE O
WHERE --O.ORDER_ID IN (SELECT ORDER_ID FROM ARBOR.CUSTOMER_ORDER WHERE ORDER_STATUS NOT IN (5,6))
--AND 
STATUS IN (20,22,23) AND QUEUE_TYPE=44 --AND TRANSACTION_ID=201050 
--AND TRUNC(CHG_DATE)>TRUNC(SYSDATE-10) --AND TRUNC(DUE_DATE)>TRUNC(SYSDATE-10) 
and owner='19.4840211141869'



SELECT ROWID,O.ORDER_ID, O.* FROM ARBOR.ORDER_WORK_QUEUE O WHERE O.ORDER_ID IN (SELECT ORDER_ID FROM ARBOR.CUSTOMER_ORDER WHERE ORDER_STATUS NOT IN (5,6))
AND STATUS IN (60) AND QUEUE_TYPE=1 --AND TRANSACTION_ID=201050 
AND TRUNC(CHG_DATE)>TRUNC(SYSDATE-20) AND TRUNC(DUE_DATE)>TRUNC(SYSDATE-20)
ORDER BY O.CHG_DATE --DESC

SELECT DISTINCT STATUS FROM ARBOR.ORDER_WORK_QUEUE O where QUEUE_TYPE=1 AND CHG_DATE>SYSDATE-3

--LATEST ERROR
SELECT A.ORDER_ID,DISPLAY_VALUE,A.QUEUE_TYPE,A.CHG_DATE
,(SELECT SQL_ERROR FROM
     (SELECT ORDER_ID, QUEUE_TYPE,CHG_DATE,SQL_ERROR
        FROM ORDER_WORK_QUEUE_ERROR E WHERE  E.ORDER_ID=A.ORDER_ID AND E.QUEUE_TYPE=A.QUEUE_TYPE
        ORDER BY ORDER_ID, QUEUE_TYPE,CHG_DATE DESC ) A
    WHERE ROWNUM=1) SQL_ERROR
FROM ARBOR.CUSTOMER_ORDER C,ARBOR.ORDER_WORK_QUEUE A,ARBOR.QUEUE_TYPE_VALUES B
WHERE C.ORDER_STATUS NOT IN (5,6) AND C.ORDER_ID=A.ORDER_ID AND A.QUEUE_TYPE  IN (44)
AND A.QUEUE_TYPE=B.QUEUE_TYPE AND B.LANGUAGE_CODE=1 AND TRUNC(CHG_DATE)>TRUNC(SYSDATE-2) AND STATUS IN (100) 

--Latest Error wise count
SELECT DISPLAY_VALUE,SQL_ERROR,COUNT(1) FROM
(SELECT A.ORDER_ID,DISPLAY_VALUE,A.QUEUE_TYPE,A.CHG_DATE
,(SELECT SQL_ERROR FROM
     (SELECT ORDER_ID, QUEUE_TYPE,CHG_DATE,SQL_ERROR
        FROM ORDER_WORK_QUEUE_ERROR E WHERE  E.ORDER_ID=A.ORDER_ID AND E.QUEUE_TYPE=A.QUEUE_TYPE
        ORDER BY ORDER_ID, QUEUE_TYPE,CHG_DATE DESC ) A
    WHERE ROWNUM=1) SQL_ERROR
FROM ARBOR.CUSTOMER_ORDER C,ARBOR.ORDER_WORK_QUEUE A,ARBOR.QUEUE_TYPE_VALUES B
WHERE C.ORDER_STATUS NOT IN (5,6) AND C.ORDER_ID=A.ORDER_ID AND A.QUEUE_TYPE  IN (44)
AND A.QUEUE_TYPE=B.QUEUE_TYPE AND B.LANGUAGE_CODE=1 AND TRUNC(CHG_DATE)>TRUNC(SYSDATE-2) AND STATUS IN (100) 
)A
GROUP BY DISPLAY_VALUE,SQL_ERROR

SELECT ROWID,O.* FROM ARBOR.ORDER_WORK_QUEUE O WHERE O.ORDER_ID IN (244450923,
244464622,
244467349,
244467058,
244467673,
244467181,
244496649,
244684946) AND STATUS<>50--=100
--AND QUEUE_TYPE=56

SELECT ROWID,OE.SQL_ERROR,OE.* FROM ARBOR.ORDER_WORK_QUEUE_ERROR OE WHERE --TRANSACTION_ID=200101 AND 
OE.ORDER_ID=239002776 ORDER BY OE.CHG_DATE DESC

SELECT QUEUE_TYPE,TRANSACTION_ID,SQL_ERROR, COUNT(1) COUNT FROM 
    (SELECT DISPLAY_VALUE,ORDER_ID, QUEUE_TYPE,TRANSACTION_ID,SQL_ERROR,CHG_DATE
     FROM (SELECT ORDER_ID, QUEUE_TYPE,TRANSACTION_ID,SQL_ERROR,MAX(CHG_DATE) CHG_DATE FROM ARBOR.ORDER_WORK_QUEUE_ERROR O 
                            WHERE O.STATUS IN (100) AND O.CHG_DATE>TRUNC(SYSDATE-2) AND O.TRANSACTION_ID=200101 AND QUEUE_TYPE IN (56)
                GROUP BY ORDER_ID, QUEUE_TYPE,TRANSACTION_ID,SQL_ERROR) A ,ARBOR.MILESTONE_VALUES B 
     WHERE A.TRANSACTION_ID=B.MILESTONE_ID AND B.LANGUAGE_CODE=1)
GROUP BY QUEUE_TYPE,TRANSACTION_ID,SQL_ERROR ORDER BY COUNT(1) DESC

SELECT DISTINCT TRANSACTION_ID, QUEUE_TYPE,TRANSACTION_ID,DISPLAY_VALUE,ORDER_ID,ARBOR.GET_ORDER_TYPE@OMPROD(a.ORDER_ID, 0) ORDER_TYPE
,(SELECT DISTINCT PARENT_EXTERNAL_ID FROM ORDER_ITEM O WHERE O.ORDER_ID=A.ORDER_ID AND O.MEMBER_TYPE=7) SUBSCR
,SQL_ERROR,CHG_DATE
     FROM (SELECT OWR.ORDER_ID, OWR.QUEUE_TYPE,OWR.TRANSACTION_ID,OWR.SQL_ERROR,MAX(OWR.CHG_DATE) CHG_DATE 
                FROM ARBOR.ORDER_WORK_QUEUE_ERROR OWR, ARBOR.ORDER_WORK_QUEUE_ERROR OW,ARBOR.CUSTOMER_ORDER CO
                            WHERE OW.STATUS=OWR.STATUS AND OW.ORDER_ID=OWR.ORDER_ID AND OW.TRANSACTION_ID=OWR.TRANSACTION_ID AND OW.QUEUE_TYPE=OWR.QUEUE_TYPE
                            AND OW.STATUS IN (100) AND OW.CHG_DATE>TRUNC(SYSDATE-2) AND OW.TRANSACTION_ID=200101 AND OW.QUEUE_TYPE IN (56)
                            AND OW.ORDER_ID=CO.ORDER_ID AND CO.ORDER_STATUS NOT IN (5,6)
                GROUP BY OWR.ORDER_ID, OWR.QUEUE_TYPE,OWR.TRANSACTION_ID,OWR.SQL_ERROR) A ,ARBOR.MILESTONE_VALUES B 
                     WHERE A.TRANSACTION_ID=B.MILESTONE_ID AND B.LANGUAGE_CODE=1
                
                
SELECT ORDER_ID,TRANSACTION_ID,SQL_ERROR,MAX(CHG_DATE) FROM ARBOR.ORDER_WORK_QUEUE_ERROR WHERE ORDER_ID=231117485
GROUP BY ORDER_ID,TRANSACTION_ID,SQL_ERROR

SELECT ORDER_ID,TRANSACTION_ID,SQL_ERROR FROM ARBOR.ORDER_WORK_QUEUE_ERROR WHERE ORDER_ID IN (SELECT ORDER_ID FROM ARBOR.CUSTOMER_ORDER WHERE ORDER_STATUS NOT IN (5,6))
AND QUEUE_TYPE IN (44) -- AND 
--TRANSACTION_ID=200479 
AND CHG_DATE>'18-SEP-2024'
--GROUP BY ORDER_ID,TRANSACTION_ID,SQL_ERROR --
ORDER BY CHG_DATE DESC

select --CHG_DATE,TRANSACTION_ID,QUEUE_TYPE,ORDER_ID,STATUS,
SQL_ERROR ,COUNT(1)
from arbor.order_work_queue_error a where a.order_id in (
select ORDER_ID from arbor.order_work_queue where QUEUE_TYPE =47 and STATUS = 100 ) 
and CHG_DATE in ( select max(CHG_DATE) from arbor.order_work_queue_error where  order_id =  a.order_id )
GROUP BY SQL_ERROR ORDER BY COUNT(1) DESC

select a.tracking_id , a.order_id,sql_error , a.due_date,a.parent_id1,a.action_id ,c.external_id,e.account_no,display_value ,
(select member_id from arbor.order_item where item_id in 
(select min(item_id) from arbor.order_item f where order_id=e.order_id and member_type=7 and item_id > e.item_id)) member_id
from arbor.order_work_queue a, arbor.order_work_queue_error b , arbor.item_milestones c, arbor.milestone_values d, arbor.order_item e, arbor.customer_order g
where a.queue_type=47 and a.status=100 and a.item_id=e.item_id  and a.order_id=g.order_id and g.order_status in (1,2,3)
and a.order_id=b.order_id and a.chg_date=b.chg_date and a.tracking_id=b.tracking_id and a.item_id=c.item_id and a.transaction_id=c.milestone_id and c.milestone_id=d.milestone_id and d.language_code=1
and sql_error  like '%NEP ERR:%'

SELECT display_value,sql_error,count(1) from
(select a.tracking_id , a.order_id,sql_error , a.due_date,a.parent_id1,a.action_id ,c.external_id,e.account_no,display_value ,
(select member_id from arbor.order_item where item_id in 
(select min(item_id) from arbor.order_item f where order_id=e.order_id and member_type=7 and item_id > e.item_id)) member_id
from arbor.order_work_queue a, arbor.order_work_queue_error b , arbor.item_milestones c, arbor.milestone_values d, arbor.order_item e, arbor.customer_order g
where a.queue_type=47 and a.status=100 and a.item_id=e.item_id  and a.order_id=g.order_id and g.order_status in (1,2,3)
and a.order_id=b.order_id and a.chg_date=b.chg_date and a.tracking_id=b.tracking_id and a.item_id=c.item_id and a.transaction_id=c.milestone_id and c.milestone_id=d.milestone_id and d.language_code=1
and sql_error  like '%NEP ERR:%'
) a
group by display_value,sql_error
order by count(1) desc

SELECT * FROM ARBOR.MILESTONE_VALUES WHERE LANGUAGE_CODE=1 --AND MILESTONE_ID=200611
AND UPPER(DISPLAY_VALUE) LIKE '%FIN%F%'

SELECT ROWID,A.* FROM ARBOR.ORDER_WORK_QUEUE A WHERE ORDER_ID=234165924-- AND STATUS=100



SELECT ROWID,A.* FROM ARBOR.ORDER_WORK_QUEUE_ERROR A WHERE --ORDER_ID=230311373 AND 
TRANSACTION_ID=200182 AND STATUS IN (22,23)

SELECT ROWID,A.* FROM ARBOR.ORDER_WORK_QUEUE A WHERE ORDER_ID IN (140691808,142504814,202563179,209779075,213534172,213708426,218296296,
219524031,222857206,224922781,225173136,225309007,225405880,225562078,225660125,229681882,232767696,233419520,233600562)
AND STATUS IN (20,22)
ORDER BY ORDER_ID

--20157-Send Message to SAS for Disconnect BarIncoming
--20191-Send Message to SAS for Disconnect Bar Outgoing Calls

/*
20-Waiting to be processed
22-
23-
27-Waiting on Dependencies
50-Complete
60-
80-
100-Failed
3035 - Order Dependency. No Action Required
9006-Manual Switch - ILINK
9010-Cancelled by Customer
9015-On hold
*/
SELECT * FROM ARBOR.ORDER_STATUS_VALUES

47-NEP